{
  "version": 3,
  "sources": ["../../../src/index.js"],
  "sourceRoot": "C:\\it_inventory\\worker\\.wrangler\\tmp\\deploy-XLhHPf",
  "sourcesContent": ["export default {\n  async fetch(request, env) {\n    const url = new URL(request.url);\n\n    /* ================== CORS ================== */\n    const corsHeaders = {\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Access-Control-Allow-Methods\": \"GET, POST, DELETE, OPTIONS\",\n      \"Access-Control-Allow-Headers\": \"Content-Type\",\n    };\n\n    if (request.method === \"OPTIONS\") {\n      return new Response(null, { headers: corsHeaders });\n    }\n\n    /* ================== HEALTH CHECK ================== */\n    if (url.pathname === \"/\" && request.method === \"GET\") {\n      return new Response(\n        JSON.stringify({\n          status: \"ITM Inventory API is running\",\n          time: new Date().toISOString(),\n        }),\n        { headers: { ...corsHeaders, \"Content-Type\": \"application/json\" } }\n      );\n    }\n\n    /* ================== ADD ASSET ================== */\n    if (url.pathname === \"/assets\" && request.method === \"POST\") {\n      const data = await request.json();\n\n      await env.DB.prepare(`\n        INSERT INTO assets (\n          role, title, name, email, batch, roll_no,\n          department, designation, emp_id, location,\n          platform, mac_address,\n          asset_desc, asset_type, serial_no, purchase_date,\n          brand, model, ram, processor, storage, remarks\n        ) VALUES (\n          ?, ?, ?, ?, ?, ?,\n          ?, ?, ?, ?,\n          ?, ?,\n          ?, ?, ?, ?,\n          ?, ?, ?, ?, ?, ?\n        )\n      `).bind(\n        data.role,\n        data.title,\n        data.name,\n        data.email,\n        data.batch || \"\",\n        data.roll_no || \"\",\n        data.department || \"\",\n        data.designation || \"\",\n        data.emp_id || \"\",\n        data.location || \"\",\n        data.platform || \"\",\n        data.mac_address || \"\",\n        data.asset_desc,\n        data.asset_type,\n        data.serial_no,\n        data.purchase_date || \"\",\n        data.brand || \"\",\n        data.model || \"\",\n        data.ram || \"\",\n        data.processor || \"\",\n        data.storage || \"\",\n        data.remarks || \"\"\n      ).run();\n\n      return new Response(\n        JSON.stringify({ success: true }),\n        { headers: { ...corsHeaders, \"Content-Type\": \"application/json\" } }\n      );\n    }\n\n    /* ================== GET / SEARCH ASSETS ================== */\n    if (url.pathname === \"/assets\" && request.method === \"GET\") {\n      const search = url.searchParams.get(\"search\") || \"\";\n      const role = url.searchParams.get(\"role\");\n      const batch = url.searchParams.get(\"batch\");\n\n      let query = \"SELECT * FROM assets WHERE 1=1\";\n      const params = [];\n\n      if (search) {\n        query += \" AND (name LIKE ? OR serial_no LIKE ? OR asset_type LIKE ?)\";\n        params.push(`%${search}%`, `%${search}%`, `%${search}%`);\n      }\n\n      if (role) {\n        query += \" AND role = ?\";\n        params.push(role);\n      }\n\n      if (batch) {\n        query += \" AND batch = ?\";\n        params.push(batch);\n      }\n\n      query += \" ORDER BY created_at DESC\";\n\n      const { results } = await env.DB.prepare(query).bind(...params).all();\n\n      return new Response(\n        JSON.stringify(results),\n        { headers: { ...corsHeaders, \"Content-Type\": \"application/json\" } }\n      );\n    }\n\n    /* ================== DELETE ASSET ================== */\n    if (url.pathname.startsWith(\"/assets/\") && request.method === \"DELETE\") {\n      const id = url.pathname.split(\"/\")[2];\n\n      await env.DB.prepare(\"DELETE FROM assets WHERE id = ?\")\n        .bind(id)\n        .run();\n\n      return new Response(\n        JSON.stringify({ success: true }),\n        { headers: { ...corsHeaders, \"Content-Type\": \"application/json\" } }\n      );\n    }\n\n    /* ================== EXPORT CSV (EXCEL) ================== */\n    if (url.pathname === \"/export\" && request.method === \"GET\") {\n      const role = url.searchParams.get(\"role\");\n      const batch = url.searchParams.get(\"batch\");\n\n      let query = \"SELECT * FROM assets WHERE role = ?\";\n      const params = [role];\n\n      if (batch && batch !== \"all\") {\n        query += \" AND batch = ?\";\n        params.push(batch);\n      }\n\n      const { results } = await env.DB.prepare(query).bind(...params).all();\n\n      let csv = \"\";\n      if (results.length) {\n        csv += Object.keys(results[0]).join(\",\") + \"\\n\";\n        results.forEach(row => {\n          csv += Object.values(row)\n            .map(v => `\"${String(v ?? \"\").replace(/\"/g, '\"\"')}\"`)\n            .join(\",\") + \"\\n\";\n        });\n      }\n\n      return new Response(csv, {\n        headers: {\n          ...corsHeaders,\n          \"Content-Type\": \"text/csv\",\n          \"Content-Disposition\": `attachment; filename=\"assets_${role}_${batch || \"all\"}.csv\"`,\n        },\n      });\n    }\n\n    /* ================== 404 ================== */\n    return new Response(\n      JSON.stringify({ error: \"Route not found\" }),\n      { status: 404, headers: corsHeaders }\n    );\n  },\n};"],
  "mappings": "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",
  "names": []
}
